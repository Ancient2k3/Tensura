-- Elemental Tycoon: Machine Gun --

local Elemental_SG, RifleToggler, DelayBox, MultiShot

Elemental_SG = Instance.new("ScreenGui", game:GetService("CoreGui"))
RifleToggler = Instance.new("TextButton", Elemental_SG)
DelayBox = Instance.new("TextBox", Elemental_SG)

Elemental_SG.Name = "AimbotSkill_PVPScript"
MultiShot = false
_G.DelayTime = _G.DelayTime or 0.05

local function findNearestPlayer()
    local localPlayer = game:GetService("Players").LocalPlayer
    local character = localPlayer.Character
    if not character then return nil end
    
    local nearestPlayer = nil
    local shortestDistance = math.huge
    
    for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
        if player ~= localPlayer and player.Character then
            local distance = (player.Character.HumanoidRootPart.Position - character.HumanoidRootPart.Position).magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestPlayer = player
            end
        end
    end
    return nearestPlayer
end

function AttackNoCD_JK()
    local localPlayer = game:GetService("Players").LocalPlayer
    local character = localPlayer.Character
    if not character then return end

    local nearestPlayer = findNearestPlayer()
    local targetPosition = nearestPlayer and nearestPlayer.Character.HumanoidRootPart.Position or character.HumanoidRootPart.Position
    
    local args = {
    [1] = "Space",
    [2] = "Space Gun",
    [3] = {
        ["Camera"] = CFrame.new(0, 0, 0) * CFrame.Angles(0, 0, 0),
        ["Mouse"] = targetPosition
        }
    }
    
    game:GetService("ReplicatedStorage").Remotes.DoMagic:FireServer(unpack(args))

    local args = {
    [1] = "Turret",
    [2] = "Energy Ball",
    [3] = {
        ["Mouse"] = targetPosition,
        ["Gun"] = workspace.Tycoons(game:GetService("Players").LocalPlayer.Name):FindFirstChild("Assets"):FindFirstChild("Turret").XYZGuns.Right,
        ["Camera"] = CFrame.new(0, 0, 0) * CFrame.Angles(0, 0, 0)
        }
    }
    
    game:GetService("ReplicatedStorage").Remotes.DoMagic:FireServer(unpack(args))
    wait(_G.DelayTime)
end

function c(ui)
    local vk = Instance.new("UICorner")
    vk.Parent = ui
    vk.CornerRadius = UDim.new(0.2, 0)
end

function ntf(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = 1.25,
        Button1 = "Reset Delay Time ?",
        Callback = (function()
            _G.DelayTime = 0.05
            print("Delay Time Reset.")
        end)
    })
end

RifleToggler.BackgroundTransparency = 0.5
RifleToggler.BackgroundColor3 = Color3.new(0, 0, 0)
RifleToggler.Position = UDim2.new(0.25, 0, 0.58, 0)
RifleToggler.Size = UDim2.new(0.05, 0, 0.1, 0)
RifleToggler.TextScaled = true
RifleToggler.TextColor3 = Color3.new(1, 1, 1)
RifleToggler.Font = Enum.Font.Code
RifleToggler.Text = "AutoShoot: OFF"
RifleToggler.Visible = true

DelayBox.BackgroundTransparency = 0.5
DelayBox.BackgroundColor3 = Color3.new(0, 0, 0)
DelayBox.Position = UDim2.new(0.32, 0, 0.58, 0)
DelayBox.Size = UDim2.new(0.05, 0, 0.1, 0)
DelayBox.TextScaled = true
DelayBox.TextColor3 = Color3.new(1, 1, 0)
DelayBox.Font = Enum.Font.Code
DelayBox.Text = ""
DelayBox.ClearTextOnFocus = false
DelayBox.PlaceholderText = "Delay"
DelayBox.Visible = true

c(RifleToggler)
c(DelayBox)

-- Connect button --

RifleToggler.MouseButton1Click:Connect(function()
    if MultiShot then
        MultiShot = false
        RifleToggler.Text = "AutoShoot: OFF"
        RifleToggler.TextColor3 = Color3.new(1, 1, 1)
    else
        MultiShot = true
        RifleToggler.Text = "AutoShoot: ON"
        RifleToggler.TextColor3 = Color3.new(0, 1, 0)
        
        game:GetService("RunService").RenderStepped:Connect(function()
            if MultiShot then
                AttackNoCD_JK()
                wait(0.01)
            end
        end)
    end
end)

DelayBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local newDelayTime = DelayBox.Text
        local CurrentNewDelayTime = tonumber(newDelayTime)
        if CurrentNewDelayTime > 0 then
            _G.DelayTime = CurrentNewDelayTime
            ntf("《Skill Delay Time》", "Current Delay Time Between Each Shot Is: [" .. _G.DelayTime .. "].")
            wait(1.5)
            DelayBox.Text = ""
        else
            ntf("》Invalid Delay Time《", "Can't Set Delay Time Between Each Shot Is Lower Than: [0].")
        end
    end
end)
