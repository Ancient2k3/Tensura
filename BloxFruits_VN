-- Remove Existed One --
local _vars = {
    player = game.Players.LocalPlayer,
    screenGuiName = "BloxFruitsMyUIVN",
    ScreenGui = Instance.new("ScreenGui"),
    OpenClose = Instance.new("TextButton"),
    HoldBoatName = Instance.new("TextBox"),
    ScrollingFrame = Instance.new("ScrollingFrame"),
    ChestBox = Instance.new("ScrollingFrame"),
    BuyStuffBox = Instance.new("ScrollingFrame"),
    SwitchFightingStyle = Instance.new("ScrollingFrame"),
    BoatSelection = Instance.new("ScrollingFrame"),
    _PLRS = game:GetService("Players"),
    _ItsMath = math.huge,
    tweenService = game:GetService("TweenService"),
    tweenSpeed = 325,
    isTweenMode = false,
    currentTween = nil,
    teleportButtons = {},
    LoopActivated_AllF = game:GetService("RunService"),
    tweenSpeedd = 1,
    tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
    goalPosition1 = UDim2.new(0.6, 0, 0.28, 0),
    goalPosition2 = UDim2.new(1.2, 0, 0.28, 0),
    tween1 = nil,
    tween2 = nil,
    isToggled = false,
    button1 = Instance.new("TextButton"),
    button2 = Instance.new("TextButton"),
    button3 = Instance.new("TextBox"),
    button4 = Instance.new("TextBox"),
    Reset = Instance.new("TextButton"),
    Shop = Instance.new("TextButton"),
    FightingStyle = Instance.new("TextButton"),
    BoatButton = Instance.new("TextButton"),
    RaidChip = Instance.new("TextBox"),
    ServerHop = Instance.new("TextButton"),
    WalkOnAir = Instance.new("TextButton"),
    GetQuestHunter = Instance.new("TextButton"),
    _loop2nearestenemies = false,
    ChangeDashLength = Instance.new("TextBox"),
    ChangeSpeedMultiplier = Instance.new("TextBox"),
    LoopsPlayers = Instance.new("TextButton"),
    LPlayers = false,
    EnemiesHealthZero = Instance.new("TextButton"),
    EnemiesHP = false,
    EnemiesHitBoxChanged = Instance.new("TextButton"),
    EnemiesHBox = false,
    SwitchedTeams = Instance.new("TextButton"),
    SwitchedT = false,
    ClickToggler = Instance.new("TextButton"),
    VU = game:GetService("VirtualUser"),
    IsClick = false,
    goalPosition3 = UDim2.new(0, 0, 0.2, 0),
    goalPosition4 = UDim2.new(-1, 0, 0.2, 0),
    tween3 = nil,
    tween4 = nil,
    goalPosition5 = UDim2.new(0.1, 0, 0.2, 0),
    goalPosition6 = UDim2.new(-1, 0, 0.2, 0),
    tween5 = nil,
    tween6 = nil,
    goalPosition7 = UDim2.new(0.2, 0, 0.2, 0),
    goalPosition8 = UDim2.new(-1, 0, 0.2, 0),
    tween7 = nil,
    tween8 = nil,
    goalPosition9 = UDim2.new(0.3, 0, 0.2, 0),
    goalPosition10 = UDim2.new(-1, 0, 0.2, 0),
    tween9 = nil,
    tween10 = nil,
    SilverChest = Instance.new("TextButton"),
    GoldenChest = Instance.new("TextButton"),
    DiamondChest = Instance.new("TextButton"),
    Boat = Instance.new("TextButton"),
    DChestF = Instance.new("TextButton"),
    DChest = false,
    AChestF = Instance.new("TextButton"),
    AChest = false,
    CheckF = Instance.new("TextButton"),
    ACheckF = Instance.new("TextButton"),
    ACheckFSet = true,
    Factory = Instance.new("TextButton"),
    fcxptl_1z = false,
    BuyItem1 = Instance.new("TextButton"),
    BuyItem2 = Instance.new("TextButton"),
    BuyItem3 = Instance.new("TextButton"),
    RandomFruit = Instance.new("TextButton"),
    DarkLeg = Instance.new("TextButton"),
    ElectricClaw = Instance.new("TextButton"),
    FishKungFu = Instance.new("TextButton"),
    DragonBreath = Instance.new("TextButton"),
    SuperHuman = Instance.new("TextButton"),
    DarkStep = Instance.new("TextButton"),
    ElectricPaw = Instance.new("TextButton"),
    SharkmanKarate = Instance.new("TextButton"),
    InfernoDragonBreath = Instance.new("TextButton"),
    GodHuman = Instance.new("TextButton"),
    SpawnPart = Instance.new("TextButton"),
    BuyBoat = Instance.new("TextButton"),
    BringBoat = Instance.new("TextButton"),
    Dinghy = Instance.new("TextButton"),
    PirateSloop = Instance.new("TextButton"),
    PirateBrigade = Instance.new("TextButton"),
    PirateGrandBrigade = Instance.new("TextButton"),
    MarineSloop = Instance.new("TextButton"),
    MarineBrigade = Instance.new("TextButton"),
    MarineGrandBrigade = Instance.new("TextButton"),
    Lantern = Instance.new("TextButton"),
    Guardian = Instance.new("TextButton"),
    EntFrame = Instance.new("Frame"),
    EntitySF = Instance.new("ScrollingFrame"),
    EntityNumber0 = Instance.new("TextButton"),
    Lvl20Boss_Dialog = Instance.new("Part"),
    EnemyHRPSelection = Instance.new("TextButton"),
    IsEnemyHRPS = false,
    VAFarm = Instance.new("TextButton"),
    VFarmA = false,
    ZeroGravity = Instance.new("TextButton"),
    AntiGravity = false,
    TrueZeroGravity = Instance.new("TextButton"),
    AntiZGravity = false,
    CounterofChest1 = Instance.new("TextLabel"),
    CounterofChest2 = Instance.new("TextLabel"),
    CounterofChest3 = Instance.new("TextLabel"),
    CounterofFruitSpawn = Instance.new("TextLabel"),
    TrueFruitDetector = Instance.new("TextButton"),
    FruitChestTrueSpawned = false,
    TrueQuestTaking = Instance.new("TextButton"),
    TutorialFrame_0 = Instance.new("TextLabel"),
    LevelCheckF = Instance.new("TextButton"),
    isToggledOn = false,
    billboardGuis = {}
}

for _, gui in ipairs(_vars.player:WaitForChild("PlayerGui"):GetChildren()) do
    if gui:IsA("ScreenGui") and gui.Name == _vars.screenGuiName then
        gui:Destroy()
    end
end

-- Blox Fruits UI V4 VN --
_vars.ScreenGui.Parent = game.CoreGui
_vars.ScreenGui.Name = _vars.screenGuiName

-- More ScrollingFrame --
local frames = {
    _vars.ChestBox,
    _vars.BuyStuffBox,
    _vars.SwitchFightingStyle,
    _vars.BoatSelection
}

for _, frame in ipairs(frames) do
    frame.Parent = _vars.ScreenGui
    frame.Size = UDim2.new(0.1, 0, 0.2, 0)
    frame.Position = UDim2.new(-1, 0, 0.2, 0)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)
    frame.BackgroundTransparency = 0.5
    frame.CanvasSize = UDim2.new(0, 0, 2, 0)
    frame.ScrollBarThickness = 0.1
end

-- Function --
function AbsoluteSmooth()
    if not _vars.player.Character.HumanoidRootPart:FindFirstChild("Extra_Wings_IX") then
        local Safety_First = Instance.new("BodyVelocity")
        Safety_First.Parent = _vars.player.Character.HumanoidRootPart
        Safety_First.Name = "Extra_Wings_IX"
        Safety_First.Velocity = Vector3.new(0, 0, 0)
        Safety_First.MaxForce = Vector3.new(_vars._ItsMath, _vars._ItsMath, _vars._ItsMath)
        warn(":3 Safety flight.")
    end
end

function AbsoluteRemove()
    if _vars.player.Character.HumanoidRootPart:FindFirstChild("Extra_Wings_IX") then
        _vars.player.Character.HumanoidRootPart:FindFirstChild("Extra_Wings_IX"):Destroy()
        warn("=-= becareful.")
    else
        warn("where is my beautiful wings...")
    end
end

-- Function to calculate tween duration based on distance and speed
local function calculateTweenDuration(startPos, endPos, speed)
    local distance = (endPos - startPos).magnitude
    return distance / speed
end

-- Define a function to create tween information
local function createTweenInfo(startPos, endPos)
    local duration = calculateTweenDuration(startPos, endPos, _vars.tweenSpeed)
    return TweenInfo.new(duration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
end

-- Function to print all player names to the console
local function printAllPlayerNames()
    for _, player in pairs(_vars._PLRS:GetPlayers()) do
        print(player.Name)
    end
end

-- Execute the printAllPlayerNames function immediately
printAllPlayerNames()

-- Close Function --
_vars.ScrollingFrame.Parent = _vars.ScreenGui
_vars.ScrollingFrame.Size = UDim2.new(0.3, 0, 0.1, 0)
_vars.ScrollingFrame.Position = UDim2.new(1.2, 0, 0.28, 0)
_vars.ScrollingFrame.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.ScrollingFrame.BackgroundTransparency = 0.5
_vars.ScrollingFrame.CanvasSize = UDim2.new(2, 0, 0, 0)
_vars.ScrollingFrame.ScrollBarThickness = 0.1

local ScrollingFrameCorner = Instance.new("UICorner")
ScrollingFrameCorner.Parent = _vars.ScrollingFrame
ScrollingFrameCorner.CornerRadius = UDim.new(0, 10)

-- OpenClose Function --
_vars.OpenClose.Parent = _vars.ScreenGui
_vars.OpenClose.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.OpenClose.BackgroundTransparency = 0.5
_vars.OpenClose.Size = UDim2.new(0.05, 0, 0.1, 0)
_vars.OpenClose.TextScaled = true
_vars.OpenClose.Position = UDim2.new(0.84, 0, -0.1, 0)
_vars.OpenClose.TextColor3 = Color3.new(1, 1, 1)
_vars.OpenClose.Font = Enum.Font.PatrickHand
_vars.OpenClose.Text = "Ⓗ"

local OpenCloseCorner = Instance.new("UICorner")
OpenCloseCorner.Parent = _vars.OpenClose
OpenCloseCorner.CornerRadius = UDim.new(0, 10)

_vars.HoldBoatName.Parent = _vars.ScreenGui
_vars.HoldBoatName.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.HoldBoatName.BackgroundTransparency = 0.5
_vars.HoldBoatName.Size = UDim2.new(0.1, 0, 0.1, 0)
_vars.HoldBoatName.TextScaled = true
_vars.HoldBoatName.Position = UDim2.new(0.64, 0, -0.1, 0)
_vars.HoldBoatName.TextColor3 = Color3.new(1, 1, 1)
_vars.HoldBoatName.Font = Enum.Font.PatrickHand
_vars.HoldBoatName.Text = "Không có thuyền"

local HoldBoatNameCorner = Instance.new("UICorner")
HoldBoatNameCorner.Parent = _vars.HoldBoatName
HoldBoatNameCorner.CornerRadius = UDim.new(0, 10)

-- Create tweens
_vars.tween1 = _vars.tweenService:Create(_vars.ScrollingFrame, _vars.tweenInfo, {Position = _vars.goalPosition1})
_vars.tween2 = _vars.tweenService:Create(_vars.ScrollingFrame, _vars.tweenInfo, {Position = _vars.goalPosition2})

-- Toggle button behavior
_vars.OpenClose.MouseButton1Click:Connect(function()
    if _vars.isToggled then
        _vars.tween2:Play()
        _vars.OpenClose.Text = "ⓧ"
        _vars.OpenClose.TextColor3 = Color3.new(0, 1, 0)
    else
        _vars.tween1:Play()
        _vars.OpenClose.Text = "Ⓗ"
        _vars.OpenClose.TextColor3 = Color3.new(1, 1, 1)
    end
    _vars.isToggled = not _vars.isToggled
end)

-- Button Ability Inside ScrollingFrame --
local buttons = {
    {
        obj = _vars.button1,
        pos = UDim2.new(0.005, 0, 0, 0),
        text = "Nhặt Rương/Trái",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.button2,
        pos = UDim2.new(0.045, 0, 0, 0),
        text = "Chế độ: Dịch chuyển tức thời",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.button3,
        pos = UDim2.new(0.085, 0, 0, 0),
        text = tostring(_vars.tweenSpeed),
        color = Color3.fromRGB(255, 255, 255),
        clearTextOnFocus = false
    },
    {
        obj = _vars.button4,
        pos = UDim2.new(0.125, 0, 0, 0),
        text = "Ghi tên người chơi",
        color = Color3.fromRGB(255, 255, 255),
        clearTextOnFocus = false
    },
    {
        obj = _vars.Reset,
        pos = UDim2.new(0.245, 0, 0, 0),
        text = "Tự hủy Haha",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.Shop,
        pos = UDim2.new(0.565, 0, 0, 0),
        text = "Chợ mua vật phẩm",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.FightingStyle,
        pos = UDim2.new(0.445, 0, 0, 0),
        text = "Đổi Võ/Melee",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.BoatButton,
        pos = UDim2.new(0.285, 0, 0, 0),
        text = "Triệu hồi thuyền/tàu",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.RaidChip,
        pos = UDim2.new(0.325, 0, 0, 0),
        text = "Nhập tên Chip Raid bằng Tiếng Anh",
        color = Color3.new(1, 1, 1),
        clearTextOnFocus = true
    },
    {
        obj = _vars.ServerHop,
        pos = UDim2.new(0.365, 0, 0, 0),
        text = "Đổi Máy Chủ Nhanh",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.WalkOnAir,
        pos = UDim2.new(0.405, 0, 0, 0),
        text = "Trên mặt đất",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.GetQuestHunter,
        pos = UDim2.new(0.205, 0, 0, 0),
        text = "Săn mục tiêu (Gần nhất)",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.ChangeDashLength,
        pos = UDim2.new(0.485, 0, 0, 0),
        text = "Lướt xa hơn",
        color = Color3.fromRGB(255, 255, 255),
        clearTextOnFocus = true
    },
    {
        obj = _vars.ChangeSpeedMultiplier,
        pos = UDim2.new(0.525, 0, 0, 0),
        text = "Tốc độ di chuyển",
        color = Color3.fromRGB(255, 255, 255),
        clearTextOnFocus = true
    },
    {
        obj = _vars.LoopsPlayers,
        pos = UDim2.new(0.165, 0, 0, 0),
        text = "Liên tục dịch chuyển",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.EnemiesHealthZero,
        pos = UDim2.new(0.605, 0, 0, 0),
        text = "Giết Quái",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.EnemiesHitBoxChanged,
        pos = UDim2.new(0.685, 0, 0, 0),
        text = "Tầm đánh rộng (Gần nhất)",
        color = Color3.fromRGB(255, 255, 255)
    },
    {
        obj = _vars.SwitchedTeams,
        pos = UDim2.new(0.725, 0, 0, 0),
        text = "Hải Quân",
        color = Color3.fromRGB(0, 255, 255)
    },
    {
        obj = _vars.ClickToggler,
        pos = UDim2.new(0.765, 0, 0, 0),
        text = "Tự động nhấp: Tắt",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.EnemyHRPSelection,
        pos = UDim2.new(0.805, 0, 0, 0),
        text = "Chọn Quái GUI: Tắt",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.TrueZeroGravity,
        pos = UDim2.new(0.845, 0, 0, 0),
        text = "Không trọng lực [Giấu]",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.TrueFruitDetector,
        pos = UDim2.new(0.885, 0, 0, 0),
        text = "Xem Rương và Trái Ác Quỷ [Giấu]",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.TrueQuestTaking,
        pos = UDim2.new(0.925, 0, 0, 0),
        text = "Khởi động[Tự động Nhiệm Vụ]",
        color = Color3.new(1, 1, 0)
    },
    {
        obj = _vars.LevelCheckF,
        pos = UDim2.new(0.965, 0, 0, 0),
        text = "Kiểm tra đồ: [Tắt]",
        color = Color3.new(1, 1, 1)
    }
}

for _, btn in ipairs(buttons) do
    btn.obj.Parent = _vars.ScrollingFrame
    btn.obj.BackgroundColor3 = Color3.new(0, 0, 0)
    btn.obj.BackgroundTransparency = 0.5
    btn.obj.Size = UDim2.new(0.03, 0, 0.9, 0)
    btn.obj.TextScaled = true
    btn.obj.Position = btn.pos
    btn.obj.TextColor3 = btn.color
    btn.obj.Font = Enum.Font.PatrickHand
    btn.obj.Text = btn.text
    if btn.clearTextOnFocus ~= nil then
        btn.obj.ClearTextOnFocus = btn.clearTextOnFocus
    end
end

_vars.Reset.MouseButton1Click:Connect(function()
    game.Players.LocalPlayer.Character.Humanoid.Health = 0
end)

_vars.Shop.MouseButton1Click:Connect(function()
    if _vars.isToggled then
        _vars.tween6:Play()
    else
        _vars.tween5:Play()
    end
    _vars.isToggled = not _vars.isToggled
end)

_vars.FightingStyle.MouseButton1Click:Connect(function()
    if _vars.isToggled then
        _vars.tween8:Play()
    else
        _vars.tween7:Play()
    end
    _vars.isToggled = not _vars.isToggled
end)

_vars.BoatButton.MouseButton1Click:Connect(function()
    if _vars.isToggled then
        _vars.tween10:Play()
    else
        _vars.tween9:Play()
    end
    _vars.isToggled = not _vars.isToggled
end)

local isToggledWalkOnAir = false
local part

_vars.WalkOnAir.MouseButton1Click:Connect(function()
    if not isToggledWalkOnAir then
        isToggledWalkOnAir = true
        _vars.WalkOnAir.Text = "Trên không khí và nước"
        _vars.WalkOnAir.TextColor3 = Color3.fromRGB(0, 255, 255)
        part = Instance.new("Part")
        part.Size = Vector3.new(5, 0.2, 5)
        part.Position = Vector3.new(
            _vars.player.Character.HumanoidRootPart.Position.X,
            _vars.player.Character.HumanoidRootPart.Position.Y - 3.5,
            _vars.player.Character.HumanoidRootPart.Position.Z
        )
        part.Anchored = true
        part.Transparency = 0.95
        part.Parent = workspace
        local lockedY = part.Position.Y
        local function updatePartPosition()
            if _vars.player.Character and _vars.player.Character:FindFirstChild("HumanoidRootPart") then
                local humanoidRootPart = _vars.player.Character.HumanoidRootPart
                part.Position = Vector3.new(
                    humanoidRootPart.Position.X,
                    lockedY,
                    humanoidRootPart.Position.Z
                )
                if humanoidRootPart.Position.Y < lockedY then
                    humanoidRootPart.CFrame = CFrame.new(
                        humanoidRootPart.Position.X,
                        lockedY + 2,
                        humanoidRootPart.Position.Z
                    )
                end
            end
        end
        local updateConnection
        updateConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if isToggledWalkOnAir then
                updatePartPosition()
            else
                updateConnection:Disconnect()
            end
        end)
    else
        isToggledWalkOnAir = false
        _vars.WalkOnAir.Text = "Trên mặt đất"
        _vars.WalkOnAir.TextColor3 = Color3.fromRGB(255, 255, 255)
        if part then
            part:Destroy()
            part = nil
        end
    end
end)

local function LoopsTPP_NearestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge
    local localPlayerPos = _vars.player.Character.HumanoidRootPart.Position
    for _, player in ipairs(_vars._PLRS:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player ~= _vars.player then
            local distance = (player.Character.HumanoidRootPart.Position - localPlayerPos).magnitude
            if distance < shortestDistance then
                nearestPlayer = player
                shortestDistance = distance
            end
        end
    end
    if nearestPlayer and nearestPlayer.Character.Humanoid.Health > 0 then
        local targetPosition = nearestPlayer.Character.HumanoidRootPart.Position + Vector3.new(0, 40, 0)
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = CFrame.new(targetPosition)}
            local tweenInfo = createTweenInfo(localPlayerPos, targetPosition)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        end
    else
        warn("No other players found")
    end
end

_vars.GetQuestHunter.MouseButton1Click:Connect(function()
    if _vars._loop2nearestenemies then
        _vars._loop2nearestenemies = false
        AbsoluteRemove()
        _vars.GetQuestHunter.TextColor3 = Color3.fromRGB(255, 255, 255)
    else
        _vars._loop2nearestenemies = true
        AbsoluteSmooth()
        _vars.GetQuestHunter.TextColor3 = Color3.fromRGB(0, 255, 0)
        _vars.LoopActivated_AllF.RenderStepped:Connect(function()
            if _vars._loop2nearestenemies then
                LoopsTPP_NearestPlayer()
            end
        end)
    end
end)

_vars.ChangeDashLength.FocusLost:Connect(function(enterPressed)
    local inputValue = tonumber(_vars.ChangeDashLength.Text)
    if inputValue then
        local character = game.Workspace.Characters[_vars.player.Name]
        character:SetAttribute("DashLength", inputValue)
    else
        warn("Missing DashLength Value Number.")
    end
end)

_vars.ChangeSpeedMultiplier.FocusLost:Connect(function(enterPressed)
    local inputValue = tonumber(_vars.ChangeSpeedMultiplier.Text)
    if inputValue then
        local character = game.Workspace.Characters[_vars.player.Name]
        character:SetAttribute("SpeedMultiplier", inputValue)
    else
        warn("Missing SpeedMultiplier Value Number.")
    end
end)

local function LoopsTPP()
    local username = _vars.button4.Text
    local player = _vars._PLRS:FindFirstChild(username)
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local targetPosition = player.Character.HumanoidRootPart.Position + Vector3.new(0, 2, 0)
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = CFrame.new(targetPosition)}
            local tweenInfo = createTweenInfo(playerPos, targetPosition)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        end
    else
        warn("Player not found: " .. username)
    end
end

_vars.LoopsPlayers.MouseButton1Click:Connect(function()
    if _vars.LPlayers then
        _vars.LoopsPlayers.TextColor3 = Color3.fromRGB(255, 255, 255)
        AbsoluteRemove()
        _vars.LPlayers = false
    else
        _vars.LoopsPlayers.TextColor3 = Color3.fromRGB(0, 255, 0)
        _vars.LPlayers = true
        AbsoluteSmooth()
        _vars.LoopActivated_AllF.RenderStepped:Connect(function()
            if _vars.LPlayers then
                LoopsTPP()
            end
        end)
    end
end)

local function findNearestEnemy()
    local nearestEnemy = nil
    local nearestDistance = math.huge
    local maxDistance = 200
    for _, enemy in pairs(game.Workspace.Enemies:GetChildren()) do
        if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") then
            local distance = (_vars.player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).magnitude
            if distance < nearestDistance and distance <= maxDistance then
                nearestDistance = distance
                nearestEnemy = enemy
            end
        end
    end
    if nearestEnemy then
        nearestEnemy.Humanoid.Health = 0
    end
end

_vars.EnemiesHealthZero.MouseButton1Click:Connect(function()
    if _vars.EnemiesHP then
        _vars.EnemiesHealthZero.TextColor3 = Color3.fromRGB(255, 255, 255)
        _vars.EnemiesHP = false
    else
        _vars.EnemiesHealthZero.TextColor3 = Color3.fromRGB(0, 255, 0)
        _vars.EnemiesHP = true
        _vars.LoopActivated_AllF.RenderStepped:Connect(function()
            if _vars.EnemiesHP then
                findNearestEnemy()
            end
        end)
    end
end)

local function HitBoxNearestEnemy()
    local nearestEnemy = nil
    local nearestDistance = math.huge
    local maxDistance = 200
    for _, enemy in pairs(game.Workspace.Enemies:GetChildren()) do
        if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") then
            local distance = (_vars.player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).magnitude
            if distance < nearestDistance and distance <= maxDistance then
                nearestDistance = distance
                nearestEnemy = enemy
            end
        end
    end
    if nearestEnemy then
        nearestEnemy.HumanoidRootPart.Size = Vector3.new(120, 120, 120)
        nearestEnemy.HumanoidRootPart.CanCollide = false
        nearestEnemy.Humanoid.WalkSpeed = 0
        nearestEnemy.Humanoid.PlatformStand = false
    end
end

_vars.EnemiesHitBoxChanged.MouseButton1Click:Connect(function()
    if _vars.EnemiesHBox then
        _vars.EnemiesHitBoxChanged.TextColor3 = Color3.fromRGB(255, 255, 255)
        _vars.EnemiesHBox = false
    else
        _vars.EnemiesHitBoxChanged.TextColor3 = Color3.fromRGB(255, 255, 0)
        _vars.EnemiesHBox = true
        _vars.LoopActivated_AllF.RenderStepped:Connect(function()
            if _vars.EnemiesHBox then
                HitBoxNearestEnemy()
            end
        end)
    end
end)

_vars.SwitchedTeams.MouseButton1Click:Connect(function()
    if _vars.SwitchedT then
        _vars.SwitchedTeams.TextColor3 = Color3.fromRGB(0, 255, 255)
        _vars.SwitchedTeams.Text = "Hải Quân"
        _vars.SwitchedT = false
        local args = {
            [1] = "SetTeam",
            [2] = "Marines"
        }
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
    else
        _vars.SwitchedTeams.TextColor3 = Color3.fromRGB(240, 190, 0)
        _vars.SwitchedTeams.Text = "Hải Tặc"
        _vars.SwitchedT = true
        local args = {
            [1] = "SetTeam",
            [2] = "Pirates"
        }
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
    end
end)

_vars.ClickToggler.MouseButton1Click:Connect(function()
    if _vars.IsClick then
        _vars.ClickToggler.Text = "Tự động nhấp: Tắt"
        _vars.ClickToggler.TextColor3 = Color3.new(1, 1, 1)
        _vars.IsClick = false
    else
        _vars.ClickToggler.Text = "Tự động nhấp: Bật"
        _vars.ClickToggler.TextColor3 = Color3.new(1, 0, 0)
        _vars.IsClick = true
        while _vars.IsClick do
            _vars.VU:CaptureController()
            _vars.VU:ClickButton1(Vector2.new(0.5, 0, 0.5))
            wait(0.1)
        end
    end
end)

-- Create tweens
_vars.tween3 = _vars.tweenService:Create(_vars.ChestBox, _vars.tweenInfo, {Position = _vars.goalPosition3})
_vars.tween4 = _vars.tweenService:Create(_vars.ChestBox, _vars.tweenInfo, {Position = _vars.goalPosition4})
_vars.tween5 = _vars.tweenService:Create(_vars.BuyStuffBox, _vars.tweenInfo, {Position = _vars.goalPosition5})
_vars.tween6 = _vars.tweenService:Create(_vars.BuyStuffBox, _vars.tweenInfo, {Position = _vars.goalPosition6})
_vars.tween7 = _vars.tweenService:Create(_vars.SwitchFightingStyle, _vars.tweenInfo, {Position = _vars.goalPosition7})
_vars.tween8 = _vars.tweenService:Create(_vars.SwitchFightingStyle, _vars.tweenInfo, {Position = _vars.goalPosition8})
_vars.tween9 = _vars.tweenService:Create(_vars.BoatSelection, _vars.tweenInfo, {Position = _vars.goalPosition9})
_vars.tween10 = _vars.tweenService:Create(_vars.BoatSelection, _vars.tweenInfo, {Position = _vars.goalPosition10})

_vars.button1.MouseButton1Click:Connect(function()
    if _vars.isToggled then
        _vars.tween4:Play()
    else
        _vars.tween3:Play()
    end
    _vars.isToggled = not _vars.isToggled
end)

_vars.button2.MouseButton1Click:Connect(function()
    _vars.isTweenMode = not _vars.isTweenMode
    _vars.button2.Text = _vars.isTweenMode and "Chế độ: Mọc cánh và bay đi" or "Chế độ: Dịch chuyển tức thời"
    _vars.button2.TextColor3 = Color3.fromRGB(255, 255, 255)
    if not _vars.isTweenMode and _vars.currentTween then
        _vars.currentTween:Cancel()
    end
end)

_vars.button3.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local newSpeed = tonumber(_vars.button3.Text)
        if newSpeed and newSpeed > 0 then
            _vars.tweenSpeed = newSpeed
        else
            warn("Invalid tween speed: " .. tostring(_vars.button3.Text))
        end
    end
end)

local function autocorrectUsername()
    local input = _vars.button4.Text:lower()
    local matchedPlayer = nil
    for _, player in ipairs(_vars._PLRS:GetPlayers()) do
        if player.Name:lower():sub(1, #input) == input then
            matchedPlayer = player.Name
            break
        end
    end
    if matchedPlayer then
        _vars.button4.Text = matchedPlayer
    else
        _vars.button4.Text = ""
    end
end

_vars.button4.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        autocorrectUsername()
        _vars.button4:ReleaseFocus()
        local username = _vars.button4.Text
        local player = _vars._PLRS:FindFirstChild(username)
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local targetPosition = player.Character.HumanoidRootPart.Position + Vector3.new(0, 2, 0)
            local playerPos = _vars.player.Character.HumanoidRootPart.Position
            if _vars.isTweenMode then
                if _vars.currentTween then
                    _vars.currentTween:Cancel()
                end
                local goal = {CFrame = CFrame.new(targetPosition)}
                local tweenInfo = createTweenInfo(playerPos, targetPosition)
                _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
                _vars.currentTween:Play()
            else
                _vars.player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
            end
        else
            warn("Player not found: " .. username)
        end
    end
end)

_vars.RaidChip.FocusLost:Connect(function(enterPressed)
    local chip = _vars.RaidChip.Text
    print("Chip value:", chip)
    local args = {
        [1] = "RaidsNpc",
        [2] = "Select",
        [3] = chip
    }
    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
    task.wait(0.1)
    local CoreGui = game:GetService("StarterGui")
    CoreGui:SetCore("SendNotification", {
        Title = "Chìa Khóa Tập Kích",
        Text = "Bạn đã mua, Chìa Khóa Tập Kích: " .. chip .. ", nếu không có nghĩa là bạn không có đủ tiền random!",
        Duration = 2,
    })
    task.wait(1)
    fireclickdetector(workspace.Map.CircleIsland.RaidSummon2.Button.Main.ClickDetector)
    CoreGui:SetCore("SendNotification", {
        Title = "Đang Tải Bản Đồ",
        Text = "Đang Gia Nhập Tập Kích: " .. chip .. ", Xin Hãy Đợi 1 Chút !",
        Duration = 2,
    })
end)

_vars.ServerHop.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/NganHa2k3/Ability/main/ServerHop_Https"))()
    local CoreGui = game:GetService("StarterGui")
    CoreGui:SetCore("SendNotification", {
        Title = "Thông Báo Hệ Thống",
        Text = "Danh sách máy chủ - Đã kích hoạt (Chờ tải....).",
        Duration = 10,
    })
end)

-- Chest TP Function --
local function IfNotFoundGChest()
    local chest = game:GetService("Workspace"):FindFirstChild("Chest1")
    if chest then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = chest.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = chest.CFrame + Vector3.new(0, 2, 0)
        end
    else
        local CoreGui = game:GetService("StarterGui")
        CoreGui:SetCore("SendNotification", {
            Title = "Thông báo",
            Text = "Đã nhặt hết rương có trong trò chơi !",
            Duration = 2,
        })
    end
end

local function IfNotFoundDChest()
    local chestg = game:GetService("Workspace"):FindFirstChild("Chest2")
    if chestg then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = chestg.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = chestg.CFrame + Vector3.new(0, 2, 0)
        end
    else
        IfNotFoundGChest()
    end
end

local function CollectChest()
    local chestd = game:GetService("Workspace"):FindFirstChild("Chest3")
    if chestd then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = chestd.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = chestd.CFrame + Vector3.new(0, 2, 0)
        end
    else
        IfNotFoundDChest()
    end
end

local function FindingSilverChest()
    local SearchingSilverChest = game:GetService("Workspace"):FindFirstChild("Chest1")
    if SearchingSilverChest then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = SearchingSilverChest.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = SearchingSilverChest.CFrame + Vector3.new(0, 2, 0)
        end
    else
        local CoreGui = game:GetService("StarterGui")
        CoreGui:SetCore("SendNotification", {
            Title = "Thông báo tự động nhặt trái và rương",
            Text = "Đã thành công tự động nhặt hết trái và rương có trong trò chơi !",
            Duration = 1,
        })
    end
end

local function FindingGoldenChest()
    local SearchingGoldenChest = game:GetService("Workspace"):FindFirstChild("Chest2")
    if SearchingGoldenChest then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = SearchingGoldenChest.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = SearchingGoldenChest.CFrame + Vector3.new(0, 2, 0)
        end
    else
        FindingSilverChest()
    end
end

local function FindingDiamondChest()
    local SearchingDiamondChest = game:GetService("Workspace"):FindFirstChild("Chest3")
    if SearchingDiamondChest then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = SearchingDiamondChest.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = SearchingDiamondChest.CFrame + Vector3.new(0, 2, 0)
        end
    else
        FindingGoldenChest()
    end
end

local function CollectFruitandChest()
    local fruit = game:GetService("Workspace"):FindFirstChild("Fruit")
    if fruit and fruit:FindFirstChild("Handle") then
        local SearchingFruit = fruit.Handle
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = SearchingFruit.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = SearchingFruit.CFrame + Vector3.new(0, 2, 0)
        end
    else
        FindingDiamondChest()
    end
end

-- CFrame Mob TP --
local function trackNearestEnemy()
    local nearestEnemy = nil
    local nearestDistance = math.huge
    local maxDistance = 1000
    for _, enemy in pairs(game.Workspace.Enemies:GetChildren()) do
        if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") then
            local distance = (_vars.player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).magnitude
            if distance < nearestDistance and distance <= maxDistance then
                nearestDistance = distance
                nearestEnemy = enemy
            end
        end
    end
    if nearestEnemy and nearestEnemy:FindFirstChild("Humanoid") then
        local humanoid = nearestEnemy.Humanoid
        local enemyPosition = nearestEnemy.HumanoidRootPart.Position + Vector3.new(0, 20, 0)
        local directionBehind = (_vars.player.Character.HumanoidRootPart.Position - enemyPosition).unit
        local behindPosition = enemyPosition + directionBehind * 1
        if _vars.isTweenMode then
            if humanoid.Health > 0 then
                local playerPos = _vars.player.Character.HumanoidRootPart.Position
                if _vars.currentTween then
                    _vars.currentTween:Cancel()
                end
                local goal = {CFrame = CFrame.new(behindPosition)}
                local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
                _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
                _vars.currentTween:Play()
            else
                nearestEnemy.HumanoidRootPart.CFrame = _vars.player.Character.HumanoidRootPart.CFrame * CFrame.new(0, 900, 0)
            end
        else
            if humanoid.Health > 0 then
                _vars.player.Character.HumanoidRootPart.CFrame = CFrame.new(behindPosition)
            else
                nearestEnemy.HumanoidRootPart.CFrame = _vars.player.Character.HumanoidRootPart.CFrame * CFrame.new(0, 900, 0)
            end
        end
    end
end

local EnemiesCFrameTo = Instance.new("TextButton")
EnemiesCFrameTo.Parent = _vars.ScrollingFrame
EnemiesCFrameTo.BackgroundColor3 = Color3.new(0, 0, 0)
EnemiesCFrameTo.BackgroundTransparency = 0.5
EnemiesCFrameTo.Size = UDim2.new(0.03, 0, 0.9, 0)
EnemiesCFrameTo.TextScaled = true
EnemiesCFrameTo.Position = UDim2.new(0.645, 0, 0, 0)
EnemiesCFrameTo.TextColor3 = Color3.fromRGB(255, 255, 255)
EnemiesCFrameTo.Font = Enum.Font.PatrickHand
EnemiesCFrameTo.Text = "Bay tới Quái (Con Gần Nhất)"

local EnemiesCF = false
EnemiesCFrameTo.MouseButton1Click:Connect(function()
    if EnemiesCF then
        EnemiesCFrameTo.TextColor3 = Color3.fromRGB(255, 255, 255)
        AbsoluteRemove()
        EnemiesCF = false
    else
        EnemiesCFrameTo.TextColor3 = Color3.fromRGB(255, 255, 0)
        EnemiesCF = true
        AbsoluteSmooth()
        _vars.LoopActivated_AllF.RenderStepped:Connect(function()
            if EnemiesCF then
                trackNearestEnemy()
            end
        end)
    end
end)

-- Chest TP --
local chestButtons = {
    {
        obj = _vars.SilverChest,
        pos = UDim2.new(0.1, 0, 0.005, 0),
        text = "Lấy Rương Bạc",
        color = Color3.fromRGB(192, 192, 192),
        chestName = "Chest1"
    },
    {
        obj = _vars.GoldenChest,
        pos = UDim2.new(0.1, 0, 0.085, 0),
        text = "Lấy Rương Vàng",
        color = Color3.new(1, 1, 0),
        chestName = "Chest2"
    },
    {
        obj = _vars.DiamondChest,
        pos = UDim2.new(0.1, 0, 0.165, 0),
        text = "Lấy Rương Kim Cương",
        color = Color3.new(0, 0, 1),
        chestName = "Chest3"
    },
    {
        obj = _vars.Boat,
        pos = UDim2.new(0.1, 0, 0.245, 0),
        text = "Lấy Trái Ác Quỷ",
        color = Color3.new(1, 0, 1),
        chestName = "Fruit"
    },
    {
        obj = _vars.DChestF,
        pos = UDim2.new(0.1, 0, 0.325, 0),
        text = "Nhặt trái và tất cả rương",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.AChestF,
        pos = UDim2.new(0.1, 0, 0.405, 0),
        text = "Nhặt hết tất cả rương (Xui là bị kick)",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.ACheckF,
        pos = UDim2.new(0.1, 0, 0.485, 0),
        text = "Kiểm tra trái ác quỷ xuất hiện",
        color = Color3.new(0, 1, 0)
    },
    {
        obj = _vars.Factory,
        pos = UDim2.new(0.1, 0, 0.565, 0),
        text = "Tới Nhà Máy Factory",
        color = Color3.new(1, 1, 1)
    }
}

for _, btn in ipairs(chestButtons) do
    btn.obj.Parent = _vars.ChestBox
    btn.obj.BackgroundColor3 = Color3.new(0, 0, 0)
    btn.obj.BackgroundTransparency = 0.5
    btn.obj.Size = UDim2.new(0.8, 0, 0.05, 0)
    btn.obj.TextScaled = true
    btn.obj.Position = btn.pos
    btn.obj.TextColor3 = btn.color
    btn.obj.Font = Enum.Font.PatrickHand
    btn.obj.Text = btn.text
end

for _, btn in ipairs({ _vars.SilverChest, _vars.GoldenChest, _vars.DiamondChest }) do
    btn.MouseButton1Click:Connect(function()
        local chest = game:GetService("Workspace"):FindFirstChild(chestButtons[({ _vars.SilverChest, _vars.GoldenChest, _vars.DiamondChest })[btn]].chestName)
        if chest then
            local playerPos = _vars.player.Character.HumanoidRootPart.Position
            if _vars.isTweenMode then
                if _vars.currentTween then
                    _vars.currentTween:Cancel()
                end
                local goal = {CFrame = chest.CFrame + Vector3.new(0, 2, 0)}
                local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
                _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
                _vars.currentTween:Play()
            else
                _vars.player.Character.HumanoidRootPart.CFrame = chest.CFrame + Vector3.new(0, 2, 0)
            end
        else
            warn("Chest not found: " .. chestButtons[({ _vars.SilverChest, _vars.GoldenChest, _vars.DiamondChest })[btn]].chestName)
        end
    end)
end

_vars.Boat.MouseButton1Click:Connect(function()
    local fruitx = game:GetService("Workspace")["Fruit"].Handle
    if fruitx then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = fruitx.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = fruitx.CFrame + Vector3.new(0, 2, 0)
        end
    else
        warn("Chest not found: Fruit")
    end
end)

_vars.DChestF.MouseButton1Click:Connect(function()
    if _vars.DChest then
        _vars.DChestF.TextColor3 = Color3.new(1, 1, 1)
        _vars.DChest = false
    else
        _vars.DChestF.TextColor3 = Color3.new(1, 1, 0)
        _vars.DChest = true
        while _vars.DChest do
            CollectFruitandChest()
            wait(1)
        end
    end
end)

_vars.AChestF.MouseButton1Click:Connect(function()
    if _vars.AChest then
        _vars.AChestF.TextColor3 = Color3.new(1, 1, 1)
        _vars.player.Character.Humanoid.Health = 0
        _vars.AChest = false
    else
        _vars.AChestF.TextColor3 = Color3.new(0, 1, 0)
        _vars.AChest = true
        loadstring(game:HttpGet("https://raw.githubusercontent.com/NganHa2k3/Tensura/refs/heads/main/BloxFruits_Update_Dragon_ChestFarm_V001"))()
    end
end)

_vars.CheckF.Parent = _vars.ScreenGui
_vars.CheckF.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.CheckF.BackgroundTransparency = 0.5
_vars.CheckF.Size = UDim2.new(0.05, 0, 0.1, 0)
_vars.CheckF.TextScaled = true
_vars.CheckF.Position = UDim2.new(0.3, 0, 0.6, 0)
_vars.CheckF.TextColor3 = Color3.new(1, 1, 1)
_vars.CheckF.Font = Enum.Font.PatrickHand
_vars.CheckF.Text = ""
_vars.CheckF.Visible = true

local CheckFUICorner = Instance.new("UICorner")
CheckFUICorner.Parent = _vars.CheckF
CheckFUICorner.CornerRadius = UDim.new(0.1, 0)

local function checkForFruit()
    local fruit = game:GetService("Workspace"):FindFirstChild("Fruit")
    if fruit and fruit:FindFirstChild("Handle") then
        _vars.CheckF.Text = "Có trái xuất hiện"
    else
        _vars.CheckF.Text = "Không có trái xuất hiện"
    end
end

_vars.ACheckF.MouseButton1Click:Connect(function()
    if _vars.ACheckFSet then
        _vars.ACheckF.TextColor3 = Color3.new(1, 1, 1)
        _vars.ACheckFSet = false
        _vars.CheckF.Visible = false
    else
        _vars.ACheckF.TextColor3 = Color3.new(0, 1, 0)
        _vars.ACheckFSet = true
        _vars.CheckF.Visible = true
        while _vars.ACheckFSet do
            checkForFruit()
            wait(0.1)
        end
    end
end)

game:GetService("RunService").RenderStepped:Connect(function()
    if _vars.ACheckFSet and _vars.CheckF.Visible then
        checkForFruit()
    end
end)

_vars.CheckF.MouseButton1Click:Connect(function()
    local fruitcheckx = game:GetService("Workspace")["Fruit"].Handle
    if fruitcheckx then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = fruitcheckx.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = fruitcheckx.CFrame + Vector3.new(0, 2, 0)
        end
    else
        warn("Chest not found: Fruit")
    end
end)

function tpsto_hahafactory()
    local Factor = game:GetService("Workspace"):FindFirstChild("Map")
        and game.Workspace.Map:FindFirstChild("Dressrosa")
        and game.Workspace.Map.Dressrosa:FindFirstChild("SmileFactory")
        and game.Workspace.Map.Dressrosa.SmileFactory:FindFirstChild("Core")
        and game.Workspace.Map.Dressrosa.SmileFactory.Core:FindFirstChild("Part")
    if Factor then
        local playerPos = _vars.player.Character.HumanoidRootPart.Position
        if _vars.isTweenMode then
            if _vars.currentTween then
                _vars.currentTween:Cancel()
            end
            local goal = {CFrame = Factor.CFrame + Vector3.new(0, 2, 0)}
            local tweenInfo = createTweenInfo(playerPos, goal.CFrame.Position)
            _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
            _vars.currentTween:Play()
        else
            _vars.player.Character.HumanoidRootPart.CFrame = Factor.CFrame + Vector3.new(0, 2, 0)
        end
    else
        warn("NO FACTOR FOUND")
    end
end

_vars.Factory.MouseButton1Click:Connect(function()
    if _vars.fcxptl_1z then
        _vars.fcxptl_1z = false
        AbsoluteRemove()
        _vars.Factory.Text = "Tới Nhà Máy Factory"
    else
        _vars.fcxptl_1z = true
        AbsoluteSmooth()
        _vars.Factory.Text = "Đang tới... chờ xíu đi"
        game:GetService("RunService").RenderStepped:Connect(function()
            if _vars.fcxptl_1z then
                tpsto_hahafactory()
            end
        end)
    end
end)

-- Shop --
local shopButtons = {
    {
        obj = _vars.BuyItem1,
        pos = UDim2.new(0.1, 0, 0.005, 0),
        text = "Mua: Nhảy trên không khí",
        args = {"BuyHaki", "Geppo"}
    },
    {
        obj = _vars.BuyItem2,
        pos = UDim2.new(0.1, 0, 0.085, 0),
        text = "Mua: Haki cường hóa",
        args = {"BuyHaki", "Buso"}
    },
    {
        obj = _vars.BuyItem3,
        pos = UDim2.new(0.1, 0, 0.165, 0),
        text = "Mua: Tốc biến",
        args = {"BuyHaki", "Soru"}
    },
    {
        obj = _vars.RandomFruit,
        pos = UDim2.new(0.1, 0, 0.245, 0),
        text = "Mua: Trái ngẫu nhiên",
        args = {"Cousin", "Buy"}
    }
}

for _, btn in ipairs(shopButtons) do
    btn.obj.Parent = _vars.BuyStuffBox
    btn.obj.BackgroundColor3 = Color3.new(0, 0, 0)
    btn.obj.BackgroundTransparency = 0.5
    btn.obj.Size = UDim2.new(0.8, 0, 0.05, 0)
    btn.obj.TextScaled = true
    btn.obj.Position = btn.pos
    btn.obj.TextColor3 = Color3.new(1, 1, 1)
    btn.obj.Font = Enum.Font.PatrickHand
    btn.obj.Text = btn.text
    btn.obj.MouseButton1Click:Connect(function()
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(btn.args))
        if btn.obj == _vars.RandomFruit then
            local CoreGui = game:GetService("StarterGui")
            CoreGui:SetCore("SendNotification", {
                Title = "Thông Báo",
                Text = "Bạn đã mua một trái ngẫu nhiên, nếu không có nghĩa là bạn không có đủ tiền random !",
                Duration = 2,
            })
        end
    end)
end)

-- Switch Melee --
local meleeButtons = {
    {
        obj = _vars.DarkLeg,
        pos = UDim2.new(0.1, 0, 0.005, 0),
        text = "Lấy võ: Chân đen v1",
        args = {"BuyBlackLeg"}
    },
    {
        obj = _vars.ElectricClaw,
        pos = UDim2.new(0.1, 0, 0.085, 0),
        text = "Lấy võ: Tay Điện v1",
        args = {"BuyElectro"}
    },
    {
        obj = _vars.FishKungFu,
        pos = UDim2.new(0.1, 0, 0.165, 0),
        text = "Lấy võ: Karate Cá v1",
        args = {"BuyFishmanKarate"}
    },
    {
        obj = _vars.DragonBreath,
        pos = UDim2.new(0.1, 0, 0.245, 0),
        text = "Lấy võ: Hơi thở của lửa v1",
        args = {"BlackbeardReward", "DragonClaw", "2"}
    },
    {
        obj = _vars.SuperHuman,
        pos = UDim2.new(0.1, 0, 0.325, 0),
        text = "Lấy võ: Siêu nhân v1",
        args = {"BuySuperhuman"}
    },
    {
        obj = _vars.DarkStep,
        pos = UDim2.new(0.1, 0, 0.405, 0),
        text = "Lấy võ: Bước chân tử thần v2",
        args = {"BuyDeathStep"}
    },
    {
        obj = _vars.ElectricPaw,
        pos = UDim2.new(0.1, 0, 0.485, 0),
        text = "Lấy võ: Móng vuốt điện v2",
        action = function() warn("Empty for now") end
    },
    {
        obj = _vars.SharkmanKarate,
        pos = UDim2.new(0.1, 0, 0.565, 0),
        text = "Lấy võ: Karate Cá mập v2",
        action = function() warn("Empty for now") end
    },
    {
        obj = _vars.InfernoDragonBreath,
        pos = UDim2.new(0.1, 0, 0.645, 0),
        text = "Lấy võ: Hơi thở của Rồng Nova v2",
        action = function() warn("Empty for now") end
    },
    {
        obj = _vars.GodHuman,
        pos = UDim2.new(0.1, 0, 0.725, 0),
        text = "Lấy võ: Nhân thần v2",
        action = function() warn("Empty for now") end
    }
}

for _, btn in ipairs(meleeButtons) do
    btn.obj.Parent = _vars.SwitchFightingStyle
    btn.obj.BackgroundColor3 = Color3.new(0, 0, 0)
    btn.obj.BackgroundTransparency = 0.5
    btn.obj.Size = UDim2.new(0.8, 0, 0.05, 0)
    btn.obj.TextScaled = true
    btn.obj.Position = btn.pos
    btn.obj.TextColor3 = Color3.new(1, 1, 1)
    btn.obj.Font = Enum.Font.PatrickHand
    btn.obj.Text = btn.text
    btn.obj.MouseButton1Click:Connect(function()
        if btn.args then
            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(btn.args))
        elseif btn.action then
            btn.action()
        end
    end)
end

-- Boat Settings --
local boatButtons = {
    {
        obj = _vars.SpawnPart,
        pos = UDim2.new(0.1, 0, 0.005, 0),
        text = "Đặt thứ này ở chỗ mua thuyền",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.BringBoat,
        pos = UDim2.new(0.1, 0, 0.085, 0),
        text = "Triệu hồi thuyền",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.BuyBoat,
        pos = UDim2.new(0.1, 0, 0.165, 0),
        text = "Mua thuyền đã chọn",
        color = Color3.new(1, 1, 1)
    },
    {
        obj = _vars.Dinghy,
        pos = UDim2.new(0.1, 0, 0.245, 0),
        text = "Thuyền nhỏ",
        color = Color3.new(1, 1, 1),
        boatName = "Dinghy"
    },
    {
        obj = _vars.PirateSloop,
        pos = UDim2.new(0.1, 0, 0.325, 0),
        text = "Thuyền cướp biển",
        color = Color3.new(1, 0, 0),
        boatName = "PirateSloop"
    },
    {
        obj = _vars.PirateBrigade,
        pos = UDim2.new(0.1, 0, 0.405, 0),
        text = "Lữ đoàn cướp biển",
        color = Color3.new(1, 0, 0),
        boatName = "PirateBrigade"
    },
    {
        obj = _vars.PirateGrandBrigade,
        pos = UDim2.new(0.1, 0, 0.485, 0),
        text = "Lữ đoàn cướp biển lớn",
        color = Color3.new(1, 0, 0),
        boatName = "PirateGrandBrigade"
    },
    {
        obj = _vars.MarineSloop,
        pos = UDim2.new(0.1, 0, 0.565, 0),
        text = "Tàu biển",
        color = Color3.new(0, 1, 1),
        boatName = "MarineSloop"
    },
    {
        obj = _vars.MarineBrigade,
        pos = UDim2.new(0.1, 0, 0.645, 0),
        text = "Lữ đoàn thủy quân lục chiến",
        color = Color3.new(0, 1, 1),
        boatName = "MarineBrigade"
    },
    {
        obj = _vars.MarineGrandBrigade,
        pos = UDim2.new(0.1, 0, 0.725, 0),
        text = "Lữ đoàn thủy quân lục chiến lớn",
        color = Color3.new(0, 1, 1),
        boatName = "MarineGrandBrigade"
    },
    {
        obj = _vars.Lantern,
        pos = UDim2.new(0.1, 0, 0.805, 0),
        text = "đèn lồng",
        color = Color3.new(1, 1, 0),
        boatName = "Lantern"
    },
    {
        obj = _vars.Guardian,
        pos = UDim2.new(0.1, 0, 0.885, 0),
        text = "Người giám hộ",
        color = Color3.new(0, 0, 1),
        boatName = "Guardian"
    }
}

for _, btn in ipairs(boatButtons) do
    btn.obj.Parent = _vars.BoatSelection
    btn.obj.BackgroundColor3 = Color3.new(0, 0, 0)
    btn.obj.BackgroundTransparency = 0.5
    btn.obj.Size = UDim2.new(0.8, 0, 0.05, 0)
    btn.obj.TextScaled = true
    btn.obj.Position = btn.pos
    btn.obj.TextColor3 = btn.color
    btn.obj.Font = Enum.Font.PatrickHand
    btn.obj.Text = btn.text
end

_vars.SpawnPart.MouseButton1Click:Connect(function()
    local existingPart = workspace:FindFirstChild("Check")
    if existingPart then
        existingPart:Destroy()
    end
    local part = Instance.new("Part")
    part.Name = "Check"
    part.Size = Vector3.new(2, 1, 2)
    part.Position = _vars.player.Character.HumanoidRootPart.Position + Vector3.new(0, 5, 0)
    part.Anchored = true
    part.Parent = workspace
end)

_vars.BuyBoat.MouseButton1Click:Connect(function()
    local part = workspace:FindFirstChild("Check")
    if part then
        _vars.player.Character.HumanoidRootPart.CFrame = part.CFrame + Vector3.new(0, 3, 0)
    end
    wait(0.02)
    local boattext = _vars.HoldBoatName.Text
    local args = {
        [1] = "BuyBoat",
        [2] = boattext
    }
    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
end)

_vars.BringBoat.MouseButton1Click:Connect(function()
    local getboat = _vars.HoldBoatName.Text
    local vehicle = game.Workspace.Boats:FindFirstChild(getboat)
    if vehicle and vehicle:IsA("Model") then
        local vehicleSeat = vehicle:FindFirstChild("VehicleSeat")
        if vehicleSeat then
            vehicleSeat.CFrame = _vars.player.Character.HumanoidRootPart.CFrame
        else
            warn("No VehicleSeat found in " .. getboat)
        end
    else
        warn("Không có thuyền named " .. getboat .. " found.")
    end
end)

local function createBoatButtonHandler(btn, boatName)
    local isSelected = false
    btn.MouseButton1Click:Connect(function()
        if isSelected then
            btn.TextColor3 = Color3.new(1, 1, 1)
            _vars.HoldBoatName.Text = "Không có thuyền"
        else
            btn.TextColor3 = Color3.new(0, 1, 0)
            _vars.HoldBoatName.Text = boatName
        end
        isSelected = not isSelected
    end)
end

for _, btn in ipairs(boatButtons) do
    if btn.boatName then
        createBoatButtonHandler(btn.obj, btn.boatName)
    end
end

-- BOSS SEA123 --
_vars.EntFrame.Parent = _vars.ScreenGui
_vars.EntFrame.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.EntFrame.BackgroundTransparency = 0.5
_vars.EntFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
_vars.EntFrame.Position = UDim2.new(0.05, 0, 0.1, 0)
_vars.EntFrame.Active = true
_vars.EntFrame.Draggable = true
_vars.EntFrame.Visible = false

local EntFrameUICorner = Instance.new("UICorner")
EntFrameUICorner.Parent = _vars.EntFrame
EntFrameUICorner.CornerRadius = UDim.new(0.1, 0)

_vars.EntitySF.Parent = _vars.EntFrame
_vars.EntitySF.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.EntitySF.BackgroundTransparency = 0.5
_vars.EntitySF.Size = UDim2.new(0.9, 0, 0.8, 0)
_vars.EntitySF.Position = UDim2.new(0.05, 0, 0.1, 0)
_vars.EntitySF.ScrollBarThickness = 0.1
_vars.EntitySF.CanvasSize = UDim2.new(0, 0, 2, 0)

_vars.EntityNumber0.Parent = _vars.EntitySF
_vars.EntityNumber0.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
_vars.EntityNumber0.BackgroundTransparency = 0
_vars.EntityNumber0.Size = UDim2.new(0.9, 0, 0.05, 0)
_vars.EntityNumber0.Position = UDim2.new(0.05, 0, 0.05, 0)
_vars.EntityNumber0.TextScaled = true
_vars.EntityNumber0.TextColor3 = Color3.new(0, 0, 0)
_vars.EntityNumber0.Font = Enum.Font.PatrickHand
_vars.EntityNumber0.Text = "Danh sách quái/boss"

local EntityNumber0UICorner = Instance.new("UICorner")
EntityNumber0UICorner.Parent = _vars.EntityNumber0
EntityNumber0UICorner.CornerRadius = UDim.new(0.1, 0)

-- Enemy HRP Selection --
_vars.EnemyHRPSelection.MouseButton1Click:Connect(function()
    if _vars.IsEnemyHRPS then
        _vars.EnemyHRPSelection.Text = "Chọn Quái GUI: Tắt"
        _vars.EnemyHRPSelection.TextColor3 = Color3.new(1, 1, 1)
        _vars.EntFrame.Visible = false
        _vars.IsEnemyHRPS = false
    else
        _vars.EnemyHRPSelection.Text = "Chọn Quái GUI: Bật"
        _vars.EnemyHRPSelection.TextColor3 = Color3.new(0, 1, 0)
        _vars.EntFrame.Visible = true
        _vars.IsEnemyHRPS = true
        -- Populate enemy list
        _vars.EntitySF:ClearAllChildren()
        local yOffset = 0.05
        for i, enemy in pairs(game.Workspace.Enemies:GetChildren()) do
            if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") then
                local enemyButton = Instance.new("TextButton")
                enemyButton.Parent = _vars.EntitySF
                enemyButton.BackgroundColor3 = Color3.new(0, 0, 0)
                enemyButton.BackgroundTransparency = 0.5
                enemyButton.Size = UDim2.new(0.9, 0, 0.05, 0)
                enemyButton.Position = UDim2.new(0.05, 0, yOffset, 0)
                enemyButton.TextScaled = true
                enemyButton.TextColor3 = Color3.new(1, 1, 1)
                enemyButton.Font = Enum.Font.PatrickHand
                enemyButton.Text = enemy.Name
                yOffset = yOffset + 0.06
                enemyButton.MouseButton1Click:Connect(function()
                    local playerPos = _vars.player.Character.HumanoidRootPart.Position
                    local targetPos = enemy.HumanoidRootPart.Position + Vector3.new(0, 2, 0)
                    if _vars.isTweenMode then
                        if _vars.currentTween then
                            _vars.currentTween:Cancel()
                        end
                        local goal = {CFrame = CFrame.new(targetPos)}
                        local tweenInfo = createTweenInfo(playerPos, targetPos)
                        _vars.currentTween = _vars.tweenService:Create(_vars.player.Character.HumanoidRootPart, tweenInfo, goal)
                        _vars.currentTween:Play()
                    else
                        _vars.player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos)
                    end
                end)
                local enemyCorner = Instance.new("UICorner")
                enemyCorner.Parent = enemyButton
                enemyCorner.CornerRadius = UDim.new(0.1, 0)
            end
        end
        _vars.EntitySF.CanvasSize = UDim2.new(0, 0, yOffset, 0)
    end
end)

-- Anti-Gravity Function --
_vars.ZeroGravity.MouseButton1Click:Connect(function()
    if _vars.AntiGravity then
        _vars.ZeroGravity.Text = "Không trọng lực [Giấu]"
        _vars.ZeroGravity.TextColor3 = Color3.new(1, 1, 1)
        _vars.AntiGravity = false
        AbsoluteRemove()
    else
        _vars.ZeroGravity.Text = "Không trọng lực [Bật]"
        _vars.ZeroGravity.TextColor3 = Color3.new(0, 1, 0)
        _vars.AntiGravity = true
        AbsoluteSmooth()
    end
end)

-- True Anti-Gravity Function --
_vars.TrueZeroGravity.MouseButton1Click:Connect(function()
    if _vars.AntiZGravity then
        _vars.TrueZeroGravity.Text = "Không trọng lực [Giấu]"
        _vars.TrueZeroGravity.TextColor3 = Color3.new(1, 1, 1)
        _vars.AntiZGravity = false
        if _vars.player.Character and _vars.player.Character:FindFirstChild("HumanoidRootPart") then
            _vars.player.Character.HumanoidRootPart.Anchored = false
        end
    else
        _vars.TrueZeroGravity.Text = "Không trọng lực [Bật]"
        _vars.TrueZeroGravity.TextColor3 = Color3.new(0, 1, 0)
        _vars.AntiZGravity = true
        if _vars.player.Character and _vars.player.Character:FindFirstChild("HumanoidRootPart") then
            _vars.player.Character.HumanoidRootPart.Anchored = true
        end
    end
end)

-- Chest and Fruit Counter --
local function updateChestCounters()
    local silverChests = 0
    local goldChests = 0
    local diamondChests = 0
    for _, obj in pairs(game.Workspace:GetChildren()) do
        if obj.Name == "Chest1" then
            silverChests = silverChests + 1
        elseif obj.Name == "Chest2" then
            goldChests = goldChests + 1
        elseif obj.Name == "Chest3" then
            diamondChests = diamondChests + 1
        end
    end
    _vars.CounterofChest1.Text = "Rương Bạc: " .. silverChests
    _vars.CounterofChest2.Text = "Rương Vàng: " .. goldChests
    _vars.CounterofChest3.Text = "Rương Kim Cương: " .. diamondChests
end

_vars.CounterofChest1.Parent = _vars.ChestBox
_vars.CounterofChest1.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.CounterofChest1.BackgroundTransparency = 0.5
_vars.CounterofChest1.Size = UDim2.new(0.8, 0, 0.05, 0)
_vars.CounterofChest1.Position = UDim2.new(0.1, 0, 0.645, 0)
_vars.CounterofChest1.TextScaled = true
_vars.CounterofChest1.TextColor3 = Color3.fromRGB(192, 192, 192)
_vars.CounterofChest1.Font = Enum.Font.PatrickHand
_vars.CounterofChest1.Text = "Rương Bạc: 0"

_vars.CounterofChest2.Parent = _vars.ChestBox
_vars.CounterofChest2.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.CounterofChest2.BackgroundTransparency = 0.5
_vars.CounterofChest2.Size = UDim2.new(0.8, 0, 0.05, 0)
_vars.CounterofChest2.Position = UDim2.new(0.1, 0, 0.725, 0)
_vars.CounterofChest2.TextScaled = true
_vars.CounterofChest2.TextColor3 = Color3.new(1, 1, 0)
_vars.CounterofChest2.Font = Enum.Font.PatrickHand
_vars.CounterofChest2.Text = "Rương Vàng: 0"

_vars.CounterofChest3.Parent = _vars.ChestBox
_vars.CounterofChest3.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.CounterofChest3.BackgroundTransparency = 0.5
_vars.CounterofChest3.Size = UDim2.new(0.8, 0, 0.05, 0)
_vars.CounterofChest3.Position = UDim2.new(0.1, 0, 0.805, 0)
_vars.CounterofChest3.TextScaled = true
_vars.CounterofChest3.TextColor3 = Color3.new(0, 0, 1)
_vars.CounterofChest3.Font = Enum.Font.PatrickHand
_vars.CounterofChest3.Text = "Rương Kim Cương: 0"

_vars.CounterofFruitSpawn.Parent = _vars.ChestBox
_vars.CounterofFruitSpawn.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.CounterofFruitSpawn.BackgroundTransparency = 0.5
_vars.CounterofFruitSpawn.Size = UDim2.new(0.8, 0, 0.05, 0)
_vars.CounterofFruitSpawn.Position = UDim2.new(0.1, 0, 0.885, 0)
_vars.CounterofFruitSpawn.TextScaled = true
_vars.CounterofFruitSpawn.TextColor3 = Color3.new(1, 0, 1)
_vars.CounterofFruitSpawn.Font = Enum.Font.PatrickHand
_vars.CounterofFruitSpawn.Text = "Trái Ác Quỷ: 0"

-- Fruit Detector --
_vars.TrueFruitDetector.MouseButton1Click:Connect(function()
    if _vars.FruitChestTrueSpawned then
        _vars.TrueFruitDetector.Text = "Xem Rương và Trái Ác Quỷ [Giấu]"
        _vars.TrueFruitDetector.TextColor3 = Color3.new(1, 1, 1)
        _vars.FruitChestTrueSpawned = false
        _vars.ChestBox.Visible = false
        for _, billboard in pairs(_vars.billboardGuis) do
            billboard:Destroy()
        end
        _vars.billboardGuis = {}
    else
        _vars.TrueFruitDetector.Text = "Xem Rương và Trái Ác Quỷ [Bật]"
        _vars.TrueFruitDetector.TextColor3 = Color3.new(0, 1, 0)
        _vars.FruitChestTrueSpawned = true
        _vars.ChestBox.Visible = true
        game:GetService("RunService").RenderStepped:Connect(function()
            if _vars.FruitChestTrueSpawned then
                updateChestCounters()
                local fruitCount = 0
                for _, obj in pairs(game.Workspace:GetChildren()) do
                    if obj.Name == "Fruit" and obj:FindFirstChild("Handle") then
                        fruitCount = fruitCount + 1
                        if not _vars.billboardGuis[obj] then
                            local billboard = Instance.new("BillboardGui")
                            billboard.Parent = obj
                            billboard.Size = UDim2.new(0, 100, 0, 50)
                            billboard.StudsOffset = Vector3.new(0, 2, 0)
                            billboard.AlwaysOnTop = true
                            local textLabel = Instance.new("TextLabel")
                            textLabel.Parent = billboard
                            textLabel.Size = UDim2.new(1, 0, 1, 0)
                            textLabel.BackgroundTransparency = 1
                            textLabel.TextColor3 = Color3.new(1, 0, 1)
                            textLabel.TextScaled = true
                            textLabel.Text = "Trái Ác Quỷ"
                            _vars.billboardGuis[obj] = billboard
                        end
                    end
                end
                _vars.CounterofFruitSpawn.Text = "Trái Ác Quỷ: " .. fruitCount
            end
        end)
    end
end)

-- Auto Quest --
local function takeQuest()
    local playerLevel = _vars.player.Data.Level.Value
    local questNPCs = {
        {level = 1, npc = "BanditQuest1"},
        {level = 10, npc = "BanditQuest2"},
        -- Add more NPCs and level requirements as needed
    }
    for _, quest in ipairs(questNPCs) do
        if playerLevel >= quest.level then
            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", quest.npc, 1)
        end
    end
end

_vars.TrueQuestTaking.MouseButton1Click:Connect(function()
    if _vars.isToggledOn then
        _vars.TrueQuestTaking.Text = "Khởi động [Tự động Nhiệm Vụ]"
        _vars.TrueQuestTaking.TextColor3 = Color3.new(1, 1, 0)
        _vars.isToggledOn = false
    else
        _vars.TrueQuestTaking.Text = "Tự động Nhiệm Vụ [Bật]"
        _vars.TrueQuestTaking.TextColor3 = Color3.new(0, 1, 0)
        _vars.isToggledOn = true
        game:GetService("RunService").RenderStepped:Connect(function()
            if _vars.isToggledOn then
                takeQuest()
            end
        end)
    end
end)

-- Level Check --
_vars.LevelCheckF.MouseButton1Click:Connect(function()
    if _vars.isToggledOn then
        _vars.LevelCheckF.Text = "Kiểm tra đồ: [Tắt]"
        _vars.LevelCheckF.TextColor3 = Color3.new(1, 1, 1)
        _vars.isToggledOn = false
        _vars.TutorialFrame_0.Visible = false
    else
        _vars.LevelCheckF.Text = "Kiểm tra đồ: [Bật]"
        _vars.LevelCheckF.TextColor3 = Color3.new(0, 1, 0)
        _vars.isToggledOn = true
        _vars.TutorialFrame_0.Visible = true
    end
end)

_vars.TutorialFrame_0.Parent = _vars.ScreenGui
_vars.TutorialFrame_0.BackgroundColor3 = Color3.new(0, 0, 0)
_vars.TutorialFrame_0.BackgroundTransparency = 0.5
_vars.TutorialFrame_0.Size = UDim2.new(0.2, 0, 0.1, 0)
_vars.TutorialFrame_0.Position = UDim2.new(0.4, 0, 0.8, 0)
_vars.TutorialFrame_0.TextScaled = true
_vars.TutorialFrame_0.TextColor3 = Color3.new(1, 1, 1)
_vars.TutorialFrame_0.Font = Enum.Font.PatrickHand
_vars.TutorialFrame_0.Text = "Cấp độ: " .. _vars.player.Data.Level.Value
_vars.TutorialFrame_0.Visible = false

local TutorialFrameUICorner = Instance.new("UICorner")
TutorialFrameUICorner.Parent = _vars.TutorialFrame_0
TutorialFrameUICorner.CornerRadius = UDim.new(0.1, 0)

-- Update Level Display --
game:GetService("RunService").RenderStepped:Connect(function()
    if _vars.isToggledOn then
        _vars.TutorialFrame_0.Text = "Cấp độ: " .. _vars.player.Data.Level.Value
    end
end)

-- Cleanup on script end --
game.Players.LocalPlayer.CharacterAdded:Connect(function()
    AbsoluteRemove()
end)

game.Players.LocalPlayer.CharacterRemoving:Connect(function()
    AbsoluteRemove()
end)

-- Notification on Script Load --
local CoreGui = game:GetService("StarterGui")
CoreGui:SetCore("SendNotification", {
    Title = "Blox Fruits UI VN",
    Text = "Script đã được tải thành công! Chúc bạn chơi vui vẻ! 😄",
    Duration = 5,
})
